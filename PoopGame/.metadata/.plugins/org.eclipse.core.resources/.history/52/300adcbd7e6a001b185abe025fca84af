package poopgame.ui;

import javax.swing.JLabel;

import com.badlogic.ashley.core.Entity;

import poopgame.gamelogic.components.PlayerComponent;
import poopgame.server.GameServer;
import poopgame.server.LocalServer;

public class WinScreen extends MenuPanel {
	private static final long serialVersionUID = 1L;
	
	private GameServer server;
	private Long activePlayerId;

	public WinScreen(Entity winner, GameServer server, Long activePlayerId) {
		super("wrap 2, fill, insets 50", "[grow]50px[right]", "[grow, center][]");

		JLabel winnerLabel = new JLabel("");
		winnerLabel.setFont(winnerLabel.getFont().deriveFont(100f));
		
		MenuButton exitButton = new MenuButton("EXIT");
		exitButton.addActionListener(e -> showMainMenu());
		add(exitButton);
		MenuButton startButton = new MenuButton("RETURN TO LOBBY");
		startButton.setEnabled(server instanceof LocalServer);
		startButton.addActionListener(e -> returnToLobby());
		add(startButton);
	}

	private void returnToLobby() {
		for (PlayerComponent player : server.getPlayers()) {
			if (player.id == activePlayerId) {
				SwingFrame.goTo(new Lobby(server, player));
				return;
			}
		}
		
		// in case the player cannot be found again
		showMainMenu();
	}

	private void showMainMenu() {
		server.dispose();
		SwingFrame.goTo(new MainMenu());
	}

}
