package poopgame.ui;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Cursor;
import java.awt.event.MouseEvent;

import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JPanel;

import com.creditsuisse.graphics.swing.JImage;
import com.creditsuisse.graphics.swing.KeyChooseButton;
import com.sun.glass.events.KeyEvent;

import poopgame.gamelogic.Champion;
import poopgame.gamelogic.InputMap;
import poopgame.gamelogic.engine.actions.ActionType;

public class ChampSelection extends MenuPanel {
	private static final long serialVersionUID = 1L;
	
	private int selectedChampIndex = 0;
	private Champion[] champs = Champion.values();
	
	private JLabel champNameLabel;
	private JImage champImage;
	
	private InputMap inputMap = new InputMap();

	public ChampSelection() {
		super("wrap 2, fill, insets 50", "[grow, right]50px[grow, left]", "[][grow, fill][][][][][]");
		
		JPanel switchPanel = new JPanel(new BorderLayout());
		switchPanel.setOpaque(false);
		MenuButton prevButton = new MenuButton("<");
		prevButton.addActionListener(e -> changeChamp(true));
		switchPanel.add(prevButton, BorderLayout.WEST);
		champNameLabel = new JLabel(champs[selectedChampIndex].getName());
		champNameLabel.setFont(champNameLabel.getFont().deriveFont(100f));
		champNameLabel.setHorizontalAlignment(JLabel.CENTER);
		switchPanel.add(champNameLabel, BorderLayout.CENTER);
		MenuButton nextButton = new MenuButton(">");
		nextButton.addActionListener(e -> changeChamp(false));
		switchPanel.add(nextButton, BorderLayout.EAST);
		
		add(switchPanel, "span 2, grow");
		

		champImage = new JImage(champs[selectedChampIndex].getSplash());
		add(champImage, "span 2, grow");
		
		add(new JLabel("MOVE LEFT"));
		add(generateKeyChooseButton(KeyEvent.VK_LEFT, false));
		
		add(new JLabel("MOVE RIGHT"));
		add(generateKeyChooseButton(KeyEvent.VK_RIGHT, false));
		
		add(new JLabel("JUMP ")); // font cuts off part of trailing P
		add(generateKeyChooseButton(KeyEvent.VK_SPACE, false));
		
		add(new JLabel("POOP ")); // font cuts off part of trailing P
		add(generateKeyChooseButton(MouseEvent.BUTTON1, true));
		
		add(new JLabel("SPECIAL"));
		add(generateKeyChooseButton(MouseEvent.BUTTON3, true));
		
		MenuButton backButton = new MenuButton("BACK");
		backButton.addActionListener(e -> SwingFrame.goTo(new MainMenu()));
		add(backButton, "left");
		MenuButton confirmButton = new MenuButton("CONFIRM");
		confirmButton.addActionListener(e -> showLobby());
		add(confirmButton, "right");
	}
	
	private void changeChamp(boolean previous) {
		selectedChampIndex += previous ? -1 : 1;
		if (selectedChampIndex >= champs.length) {
			selectedChampIndex = 0;
		} else if (selectedChampIndex < 0) {
			selectedChampIndex = champs.length - 1;
		}
		
		Champion champ = champs[selectedChampIndex];
		champNameLabel.setText(champ.getName());
		champImage = new JImage(champ.getSplash());
	}
	
	private KeyChooseButton generateKeyChooseButton(ActionType action) {
		KeyChooseButton button = new KeyChooseButton(keyCode, true, true);
		button.setKeyCode(keyCode, isMouse);
		button.setBorderPainted(false);
		button.setContentAreaFilled(false);
		button.setFocusPainted(false);
		button.setOpaque(false);
		button.setHorizontalAlignment(JButton.LEFT);
		button.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
		button.setChooseText("press any key...");
		button.setForeground(new Color(60, 115, 87));
		return button;
	}

	private void showLobby() {
		try {
			SwingFrame.goTo(new Lobby(null, champs[selectedChampIndex]));
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
